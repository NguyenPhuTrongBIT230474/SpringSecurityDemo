<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω d·ªãch v·ª•</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Moon+Dance&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #ffeedd;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: auto;
            padding: 20px;
        }

        /* ========== Navbar Header ========== */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #686463;
            padding: 15px 30px;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar .logo {
            font-weight: 600;
            font-family: 'Moon Dance', cursive;
            font-size: 32px; /* t√πy ch·ªânh k√≠ch th∆∞·ªõc */
            text-decoration: none;
            color: white;
        }

        .navbar .menu a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .navbar .menu a:hover {
            color: #ffdd66;
        }

        /* ========== Page Header ƒê·∫∑c S·∫Øc ========== */
        .page-header-special {
            background: white;
            color: #686463;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .page-header-special h2 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .page-header-special p {
            font-size: 18px;
            color: 686463;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .page-header-special .btn-secondary {
            background-color: #686463;
            color: white;
            border: 1px solid rgba(255,255,255,0.4);
            padding: 8px 18px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .page-header-special .btn-secondary:hover {
            background-color: #302e2d;
            border-color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }


        /* ========== Search Bar ========== */
        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .search-bar button {
            padding: 8px 20px;
            border-radius: 8px;
            border: none;
            background-color: #686463;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .search-bar button:hover {
            background-color: #686463;
        }

        /* ========== Table ========== */
        .table {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .table thead th {
            background-color: #686463;
            color: white;
            text-align: center;
            font-weight: 600;
        }

        .table tbody td {
            text-align: center;
            vertical-align: middle;
        }

        .table tbody tr:hover {
            background-color: #fff4a3;
        }

        /* ========== Action Buttons ========== */
        .btn-action {
            margin: 0 2px;
            font-size: 16px;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .btn-action:hover {
            opacity: 0.85;
        }

        /* ========== Pagination ========== */
        .pagination .page-link {
            color: #686463;
            font-weight: 500;
        }

        .pagination .page-link:hover {
            background-color: #686463;
            color: white;
        }

        .pagination .page-item.active .page-link {
            background-color: #686463;
            border-color: #686463;
            color: white;
        }

        /* ========== Add Button ========== */
        .add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #686463;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 18px rgba(0,0,0,0.3);
            background-color: #302e2d;
        }

        /* ========== Responsive ========== */
        @media (max-width: 768px) {
            .search-bar {
                flex-direction: column;
            }

            .search-bar input,
            .search-bar button {
                width: 100%;
            }

            .page-header h2 {
                font-size: 22px;
            }
        }

        /* Image preview */
        #preview {
            border-radius: 12px;
            border: 1px solid #ccc;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<header class="navbar">
    <a th:href="@{/}" class="logo">üè†Ô∏é Th·∫©m m·ªπ vi·ªán C1-TW</a>
    <nav class="menu">
        <a href="#">Khuy·∫øn m√£i</a>
        <a th:href="@{/services}">D·ªãch v·ª•</a>
        <a href="#">Kh√°ch h√†ng</a>
        <a href="#">Nh√¢n vi√™n</a>
        <a href="#">ƒê·∫∑t l·ªãch</a>
        <a href="#">Thanh to√°n</a>
        <a href="#">S·∫£n ph·∫©m</a>
    </nav>
</header>

<div class="page-header-special">
    <h2><i class="bi bi-people"></i> Qu·∫£n l√Ω D·ªãch v·ª•</h2>
    <p>Qu·∫£n l√Ω danh s√°ch d·ªãch v·ª• d√†nh cho kh√°ch h√†ng trong salon</p>
    <a class="btn btn-secondary" th:href="@{/}">‚Üê Quay l·∫°i</a>
</div>

<div class="container py-4">

    <!-- c√≥ bo tr√≤n -->
    <div class="row mb-3">
        <div class="search-bar">
            <input id="searchInput" class="form-control me-2" type="text" placeholder="Nh·∫≠p t√™n d·ªãch v·ª• ho·∫∑c lo·∫°i...">
            <button class="btn btn-dark" type="submit">üîç T√¨m ki·∫øm</button>
        </div>
    </div>

    <!-- Table -->
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th>ID</th>
            <th>·∫¢nh m·∫´u</th>
            <th id="thServiceName" style="cursor:pointer;" >T√™n d·ªãch v·ª• ‚áÖ</th>
            <th id="thPrice" style="cursor:pointer;">Gi√° (VND) ‚áÖ</th>
            <th>Th·ªùi gian th·ª±c hi·ªán</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Lo·∫°i</th>
            <th>Thao t√°c</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="service, iterStat : ${services}">
            <td th:text="${service.serviceId}"></td>
            <td>
                <img th:if="${service.image != null}" th:src="@{'/services/image/' + ${service.serviceId}}" width="80" id="preview">
            </td>
            <td th:text="${service.serviceName}"></td>
            <td th:text="${service.price}"></td>
            <td th:text="${service.duration} + ' ph√∫t'"></td>
            <td th:text="${service.status}"></td>
            <td th:text="${service.category}"></td>
            <td>
                <!-- <a class="btn btn-info btn-sm btn-action" th:href="@{'/services/view/' + ${service.serviceId}}">üëÅ</a> -->
                <a class="btn btn-warning btn-sm btn-action" th:href="@{'/services/edit/' + ${service.serviceId}}">‚úèÔ∏è</a>
                <a class="btn btn-danger btn-sm btn-action" th:href="@{'/services/delete/' + ${service.serviceId}}"
                   onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√¥ng?')">üóë</a>
            </td>
        </tr>
        </tbody>
    </table>

    <nav>
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="#" onclick="prevPage()">¬´</a>
            </li>
            <li class="page-item disabled">
                <span class="page-link" id="page-info"></span>
            </li>
            <li class="page-item">
                <a class="page-link" href="#" onclick="nextPage()">¬ª</a>
            </li>
        </ul>
    </nav>

    <!-- Add button -->
    <a class="btn btn-success add-btn" th:href="@{/services/new}">+</a>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const services = /*[[${services}]]*/ []; // danh s√°ch t·ª´ server
        const tbody = document.querySelector("tbody");
        const searchInput = document.getElementById('searchInput');

        const pageSize = 5;
        let currentPage = 1;

        let nameAsc = true;
        let priceAsc = true;
        let currentList = [...services]; // danh s√°ch ƒëang hi·ªÉn th·ªã

        function renderTable(list) {
            tbody.innerHTML = '';
            list.forEach((service, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${service.serviceId}</td>
                <td>${service.image ? `<img src="/services/image/${service.serviceId}" width="80" id="preview">` : ''}</td>
                <td>${service.serviceName}</td>
                <td>${service.price}</td>
                <td>${service.duration} ph√∫t</td>
                <td>${service.status}</td>
                <td>${service.category}</td>
                <td>
                    <a href="/services/edit/${service.serviceId}">‚úèÔ∏è</a>
                    <a href="/services/delete/${service.serviceId}" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kh√¥ng?')">üóë</a>
                </td>
            `;
                tbody.appendChild(row);
            });
            showPage(1); // reset pagination
        }

        // --- Pagination ---
        function showPage(page) {
            currentPage = page;
            const rows = tbody.querySelectorAll("tr");
            const start = (page - 1) * pageSize;
            const end = page * pageSize;

            rows.forEach((row, idx) => {
                row.style.display = (idx >= start && idx < end) ? "" : "none";
            });

            document.getElementById("page-info").innerText = `Trang ${currentPage} / ${Math.ceil(rows.length / pageSize)}`;
        }

        function prevPage() { if(currentPage > 1) showPage(currentPage - 1); }
        function nextPage() {
            const rows = tbody.querySelectorAll("tr");
            if(currentPage < Math.ceil(rows.length / pageSize)) showPage(currentPage + 1);
        }

        // --- Sort ---
        document.getElementById('thServiceName').addEventListener('click', () => {
            currentList.sort((a,b) => nameAsc
                ? a.serviceName.localeCompare(b.serviceName)
                : b.serviceName.localeCompare(a.serviceName)
            );
            nameAsc = !nameAsc;
            renderTable(currentList);
        });

        document.getElementById('thPrice').addEventListener('click', () => {
            currentList.sort((a,b) => priceAsc ? a.price - b.price : b.price - a.price);
            priceAsc = !priceAsc;
            renderTable(currentList);
        });

        // --- Search real-time ---
        function applySearchHighlight() {
            const keyword = searchInput.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');
            rows.forEach(row => {
                const serviceName = row.cells[2].innerText.toLowerCase();
                const serviceCatgory = row.cells[6].innerText.toLowerCase();
                if(serviceName.includes(keyword) || serviceCatgory.includes(keyword)) {
                    row.style.display = '';
                    row.style.backgroundColor = '#fff4a3';
                } else {
                    row.style.display = 'none';
                    row.style.backgroundColor = '';
                }
            });
        }

        // --- Render l·∫ßn ƒë·∫ßu ---
        document.addEventListener("DOMContentLoaded", () => renderTable(currentList));
        /*]]>*/

        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');

        imageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                }
                reader.readAsDataURL(file);
            }
        });
    </script>
</div>
</body>
</html>
