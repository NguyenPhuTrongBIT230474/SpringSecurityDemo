<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"> <head th:replace="~{fragments/common :: head}">
    <title>Quản lý Nhân viên</title>
</head>
<body>
<nav th:replace="~{fragments/common :: navigation}"></nav>

<div class="page-header">
    <div class="container">
        <h1 class="mb-0">Danh sách Nhân viên</h1>
        <p class="mb-0 mt-2">Quản lý thông tin, ca làm việc và chuyên môn của nhân viên.</p>
    </div>
</div>

<div class="container">
    <div class="card search-card mb-4">
        <div class="card-body">
            <h5 class="card-title mb-3">Tìm kiếm Nhân viên</h5>
            <form th:action="@{/staff}" method="get" th:object="${searchRequest}">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="searchName" class="form-label">Tên nhân viên</label>
                        <input type="text" class="form-control" id="searchName" th:field="*{name}">
                    </div>
                    <div class="col-md-3">
                        <label for="searchPosition" class="form-label">Chức vụ</label>
                        <select class="form-select" id="searchPosition" th:field="*{position}">
                            <option value="">Tất cả chức vụ</option>
                            <option th:each="pos : ${positions}" th:value="${pos}" th:text="${pos}"></option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label for="searchSpecialization" class="form-label">Chuyên môn</label>
                        <select class="form-select" id="searchSpecialization" th:field="*{specialization}">
                            <option value="">Tất cả chuyên môn</option>
                            <option th:each="spec : ${specializations}" th:value="${spec}" th:text="${spec}"></option>
                        </select>
                    </div>
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-coffee w-100"> <i class="fas fa-search me-1"></i> Tìm kiếm
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="mb-3" sec:authorize="hasRole('ADMIN')">
        <a th:href="@{/staff/add}" class="btn btn-coffee">
            <i class="fas fa-plus me-1"></i> Thêm Nhân viên
        </a>
    </div>

    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-hover align-middle">
                    <thead class="table-dark">
                    <tr>
                        <th>ID</th>
                        <th>Tên Nhân viên</th>
                        <th>Tên đăng nhập</th>
                        <th>Chức vụ</th>
                        <th>Chuyên môn</th>
                        <th>Ca làm việc</th>
                        <th>Lương (VNĐ)</th>
                        <th>Hành động</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="staff : ${staffList}">
                        <td th:text="${staff.id}">1</td>
                        <td th:text="${staff.name}" class="fw-bold">Nguyễn Văn A</td>
                        <td th:text="${staff.user?.username ?: 'N/A'}" style="color: #555;">nva_staff</td>
                        <td th:text="${staff.position}">Staff</td>
                        <td th:text="${staff.specialization}">Chăm sóc da</td>
                        <td th:text="${staff.workShift?.getDisplayName()}">Ca Sáng</td>
                        <td th:text="${#numbers.formatDecimal(staff.salary, 0, 'COMMA', 0, 'POINT')}" class="price-display">8,000,000</td>
                        <td>
                            <a th:href="@{/staff/{id}(id=${staff.id})}" class="btn btn-sm btn-info me-1" title="Xem">
                                <i class="fas fa-eye"></i>
                            </a>
                            <th:block sec:authorize="hasRole('ADMIN')">
                                <a th:href="@{/staff/edit/{id}(id=${staff.id})}" class="btn btn-sm btn-primary me-1" title="Sửa">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <form th:action="@{/staff/delete/{id}(id=${staff.id})}" method="post" class="d-inline"
                                      onsubmit="return confirm('Bạn có chắc chắn muốn xóa nhân viên này?');">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </th:block>
                        </td>
                    </tr>

                    <tr th:if="${staffPage.totalElements == 0}">
                        <td colspan="8" class="text-center p-4">Không tìm thấy nhân viên nào.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <nav th:if="${staffPage.totalPages > 1}" aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${staffPage.isFirst()} ? 'disabled'">
                        <a class="page-link" th:href="@{/staff(page=0, size=${staffPage.size}, name=${searchName}, position=${searchPosition}, specialization=${searchSpecialization})}">Đầu</a>
                    </li>
                    <li class="page-item" th:classappend="${staffPage.hasPrevious()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/staff(page=${staffPage.number - 1}, size=${staffPage.size}, name=${searchName}, position=${searchPosition}, specialization=${searchSpecialization})}">Trước</a>
                    </li>

                    <li class="page-item" th:each="i : ${#numbers.sequence(0, staffPage.totalPages - 1)}" th:classappend="${i == staffPage.number} ? 'active'">
                        <a class="page-link" th:href="@{/staff(page=${i}, size=${staffPage.size}, name=${searchName}, position=${searchPosition}, specialization=${searchSpecialization})}" th:text="${i + 1}"></a>
                    </li>

                    <li class="page-item" th:classappend="${staffPage.hasNext()} ? '' : 'disabled'">
                        <a class="page-link" th:href="@{/staff(page=${staffPage.number + 1}, size=${staffPage.size}, name=${searchName}, position=${searchPosition}, specialization=${searchSpecialization})}">Sau</a>
                    </li>
                    <li class="page-item" th:classappend="${staffPage.isLast()} ? 'disabled'">
                        <a class="page-link" th:href="@{/staff(page=${staffPage.totalPages - 1}, size=${staffPage.size}, name=${searchName}, position=${searchPosition}, specialization=${searchSpecialization})}">Cuối</a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</body>
</html>